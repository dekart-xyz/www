<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://dekart.xyz/main.2e5381534a8860b2a759a350fd81ad460e43f551309ea61ba674ac7cc4b422e140f27910474cf76f85aa825796905d69be90e087c648760e6993fd2e3f1584cf.css integrity="sha512-LlOBU0qIYLKnWaNQ/YGtRg5D9VEwnqYbpnSsfMS0IuFA8nkQR0z3b4WqgleWkF1pvpDgh8ZIdg5pk/0uPxWEzw==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Kepler.gl + DuckDB (WASM): configuration and custom SQL UI - Dekart</title><meta name=description content="Minimal steps to enable DuckDB-WASM in a Kepler.gl app and run DuckDB SQL from a custom UI so results show up as a new layer."><link rel=canonical href=https://dekart.xyz/blog/kepler.gl--duckdb-wasm-configuration-and-custom-sql-ui/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dekart.xyz/dekart-social-preview-0-18.png"><meta name=twitter:title content="Kepler.gl + DuckDB (WASM): configuration and custom SQL UI"><meta name=twitter:description content="Minimal steps to enable DuckDB-WASM in a Kepler.gl app and run DuckDB SQL from a custom UI so results show up as a new layer."><meta name=twitter:creator content="@delfrrr"><meta property="og:title" content="Kepler.gl + DuckDB (WASM): configuration and custom SQL UI"><meta property="og:description" content="Minimal steps to enable DuckDB-WASM in a Kepler.gl app and run DuckDB SQL from a custom UI so results show up as a new layer."><meta property="og:type" content="article"><meta property="og:url" content="https://dekart.xyz/blog/kepler.gl--duckdb-wasm-configuration-and-custom-sql-ui/"><meta property="og:image" content="https://dekart.xyz/dekart-social-preview-0-18.png"><meta property="article:published_time" content="2026-02-23T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-23T18:55:16+01:00"><meta property="og:site_name" content="Dekart"><meta property="og:locale" content="en_US"><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://dekart.xyz/apple-icon.png><link rel=icon type=image/png sizes=32x32 href=https://dekart.xyz/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://dekart.xyz/favicon-16x16.png><link rel=manifest href=https://dekart.xyz/site.webmanifest><script defer data-domain=dekart.xyz src=https://plausible.io/js/script.tagged-events.js></script></head><body><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label>
<a class="navbar-brand order-1 order-md-0 mr-auto" href=https://dekart.xyz/>Dekart</a><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=http://github.com/dekart-xyz/dekart><svg width="24" height="24" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M512 0C229.12.0.0 229.12.0 512c0 226.56 146.56 417.92 350.08 485.76 25.6 4.48 35.2-10.88 35.2-24.32.0-12.16-.64-52.48-.64-95.36-128.64 23.68-161.92-31.36-172.16-60.16-5.76-14.72-30.72-60.16-52.48-72.32-17.92-9.6-43.52-33.28-.64-33.92 40.32-.64 69.12 37.12 78.72 52.48 46.08 77.44 119.68 55.68 149.12 42.24 4.48-33.28 17.92-55.68 32.64-68.48-113.92-12.8-232.96-56.96-232.96-252.8.0-55.68 19.84-101.76 52.48-137.6-5.12-12.8-23.04-65.28 5.12-135.68.0.0 42.88-13.44 140.8 52.48 40.96-11.52 84.48-17.28 128-17.28s87.04 5.76 128 17.28c97.92-66.56 140.8-52.48 140.8-52.48 28.16 70.4 10.24 122.88 5.12 135.68 32.64 35.84 52.48 81.28 52.48 137.6.0 196.48-119.68 240-233.6 252.8 18.56 16 34.56 46.72 34.56 94.72.0 68.48-.64 123.52-.64 140.8.0 13.44 9.6 29.44 35.2 24.32C877.44 929.92 1024 737.92 1024 512 1024 229.12 794.88.0 512 0z" fill="#1b1f23"/></svg><span class="ml-2 sr-only">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://dekart.xyz/cloud>Pricing</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://dekart.xyz/self-hosted/>Self-Hosting</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://dekart.xyz/docs/about/overture-maps-examples/>Examples</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://dekart.xyz/data-sales-demos/>Data Providers</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://slack.dekart.xyz>üõü Ask in Slack</a></li></ul><div class="break order-6 d-md-none"></div><ul class="navbar-nav navbar-login flex-grow-1 order-7 order-md-3 justify-content-end"><li class=nav-item><a class="nav-link text-nowrap" href="https://cloud.dekart.xyz/?ref=login" target=_blank rel="noopener noreferrer">Login</a></li><li class=nav-item><a class="btn btn-primary" href="https://cloud.dekart.xyz/?ref=start-now" role=button>Start Now</a></li></ul></div></div></header><div class="wrap container" role=document><div class=content><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>Kepler.gl + DuckDB (WASM): configuration and custom SQL UI</h1><p><small>by <a class="stretched-link position-relative" href=https://dekart.xyz/contributors/vladi/>Vladi</a>&nbsp;&dash;&nbsp;<strong>4&nbsp;min read</strong></small><p></div><p class=lead></p><p>This document describes the minimal steps to:</p><ol><li>enable DuckDB-WASM inside a Kepler.gl app, and</li><li>run DuckDB SQL from a custom UI (your own editor + Run button) so the result is added to Kepler as a new dataset and auto-creates a layer.</li></ol><h2 id=1-install-dependencies>1) Install dependencies</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install @kepler.gl/duckdb
</span></span></code></pre></div><h2 id=2-configure-kepler-required>2) Configure Kepler (required)</h2><p>Call <code>initApplicationConfig</code> once before the map is used:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>initApplicationConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@kepler.gl/utils&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>KeplerGlDuckDbTable</span><span class=p>,</span> <span class=nx>DuckDBWasmAdapter</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@kepler.gl/duckdb&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>initApplicationConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Required: makes dataset ingestion and ‚Äúadd Arrow result to map‚Äù follow the DuckDB path.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>table</span><span class=o>:</span> <span class=nx>KeplerGlDuckDbTable</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Required: DuckDB-WASM adapter used by your custom editor.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>database</span><span class=o>:</span> <span class=k>new</span> <span class=nx>DuckDBWasmAdapter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>debug</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>config</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Recommended for visualization: avoid bigint/decimal type issues downstream.
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>query</span><span class=o>:</span> <span class=p>{</span> <span class=nx>castBigIntToDouble</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Recommended: DuckDB execution is async.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>useArrowProgressiveLoading</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>Notes:</p><ul><li><code>DuckDBWasmAdapter</code> runs DuckDB in a Web Worker and provides <code>connect()</code> + <code>query()</code>.</li><li><code>KeplerGlDuckDbTable</code> controls how datasets are ingested into DuckDB and read back as Arrow.</li></ul><h3 id=under-the-hood-short>Under the hood (short)</h3><ul><li>DuckDB runs in-browser via <code>@duckdb/duckdb-wasm</code> inside a Web Worker (the adapter selects the right WASM bundle and initializes the worker).</li><li>Kepler switches its dataset storage path by swapping the table class to <code>KeplerGlDuckDbTable</code> via <code>initApplicationConfig</code>.</li><li>Query results are passed to Kepler as Apache Arrow (<code>info.format = 'arrow'</code>) to avoid materializing large result sets into JS arrays.</li><li>The SQL Panel path typically casts types for compatibility (e.g. geometry ‚Üí WKB; bigint/decimal ‚Üí double) and attaches GeoArrow metadata for geometry columns.</li></ul><h3 id=keplerglduckdbtable-what-it-actually-changes><code>KeplerGlDuckDbTable</code> (what it actually changes)</h3><ul><li>On dataset import/update, it creates (or replaces) a DuckDB table named after the dataset label.</li><li>It can ingest rows, GeoJSON (via <code>ST_READ(..., keep_wkb=TRUE)</code>), or Arrow (via <code>insertArrowTable</code>), and it loads DuckDB‚Äôs <code>spatial</code> extension when needed.</li><li>After ingestion, it runs a generated <code>SELECT</code> that casts types for Kepler (geometry ‚Üí WKB, bigint/decimal ‚Üí double, etc.) and returns an Arrow table.</li><li>Kepler UI then uses Arrow <code>fields + cols</code> (and no JS <code>rows</code>), while DuckDB remains the source-of-truth for SQL.</li></ul><h2 id=3-run-duckdb-sql-from-a-custom-ui-and-add-the-result-to-kepler>3) Run DuckDB SQL from a custom UI and add the result to Kepler</h2><p>Kepler‚Äôs built-in SQL Panel uses this approach:</p><ul><li>run SQL (optionally multiple statements)</li><li>ensure the final statement is a <code>SELECT</code></li><li>materialize it into a temp table</li><li>re-select with type casts (geometry ‚Üí WKB; bigint/decimal ‚Üí double)</li><li>dispatch <code>addDataToMap</code> with <code>info.format = 'arrow'</code></li></ul><p>Minimal implementation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>getApplicationConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@kepler.gl/utils&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>addDataToMap</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@kepler.gl/actions&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>arrowSchemaToFields</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@kepler.gl/processors&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>generateHashId</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@kepler.gl/common-utils&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>getDuckDBColumnTypes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>getDuckDBColumnTypesMap</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>castDuckDBTypesForKepler</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setGeoArrowWKBExtension</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>splitSqlStatements</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>removeSQLComments</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>checkIsSelectQuery</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@kepler.gl/duckdb&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TEMP_TABLE</span> <span class=o>=</span> <span class=s1>&#39;temp_keplergl_table&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>runDuckDbSqlAndAddToMap</span> <span class=p>({</span> <span class=nx>sql</span><span class=p>,</span> <span class=nx>label</span><span class=p>,</span> <span class=nx>dispatch</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>getApplicationConfig</span><span class=p>().</span><span class=nx>database</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>db</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;DuckDB is not configured&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>cleaned</span> <span class=o>=</span> <span class=nx>removeSQLComments</span><span class=p>(</span><span class=nx>sql</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>cleaned</span><span class=p>.</span><span class=nx>trim</span><span class=p>())</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Query is empty&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>c</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>db</span><span class=p>.</span><span class=nx>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>statements</span> <span class=o>=</span> <span class=nx>splitSqlStatements</span><span class=p>(</span><span class=nx>cleaned</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>arrowTable</span> <span class=o>=</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>tableDuckDBTypes</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>statements</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>statement</span> <span class=o>=</span> <span class=nx>statements</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>isLast</span> <span class=o>=</span> <span class=nx>i</span> <span class=o>===</span> <span class=nx>statements</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>isLast</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=kr>await</span> <span class=nx>checkIsSelectQuery</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>statement</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>c</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`CREATE OR REPLACE TABLE &#34;</span><span class=si>${</span><span class=nx>TEMP_TABLE</span><span class=si>}</span><span class=sb>&#34; AS </span><span class=si>${</span><span class=nx>statement</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>duckDbColumns</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getDuckDBColumnTypes</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>TEMP_TABLE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>tableDuckDBTypes</span> <span class=o>=</span> <span class=nx>getDuckDBColumnTypesMap</span><span class=p>(</span><span class=nx>duckDbColumns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>adjustedSql</span> <span class=o>=</span> <span class=nx>castDuckDBTypesForKepler</span><span class=p>(</span><span class=nx>TEMP_TABLE</span><span class=p>,</span> <span class=nx>duckDbColumns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>arrowTable</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>c</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=nx>adjustedSql</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>setGeoArrowWKBExtension</span><span class=p>(</span><span class=nx>arrowTable</span><span class=p>,</span> <span class=nx>duckDbColumns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>c</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=sb>`DROP TABLE &#34;</span><span class=si>${</span><span class=nx>TEMP_TABLE</span><span class=si>}</span><span class=sb>&#34;`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>c</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=nx>statement</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>arrowTable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Last statement must be a SELECT&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fields</span> <span class=o>=</span> <span class=nx>arrowSchemaToFields</span><span class=p>(</span><span class=nx>arrowTable</span><span class=p>,</span> <span class=nx>tableDuckDBTypes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>dispatch</span><span class=p>(</span><span class=nx>addDataToMap</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>datasets</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>        <span class=nx>info</span><span class=o>:</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>generateHashId</span><span class=p>(),</span> <span class=nx>label</span><span class=o>:</span> <span class=nx>label</span> <span class=o>||</span> <span class=s1>&#39;query_result&#39;</span><span class=p>,</span> <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;arrow&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=p>{</span> <span class=nx>fields</span><span class=p>,</span> <span class=nx>rows</span><span class=o>:</span> <span class=nx>arrowTable</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}],</span>
</span></span><span class=line><span class=cl>      <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Default is true in Kepler; include explicitly if you depend on it.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>autoCreateLayers</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>c</span><span class=p>.</span><span class=nx>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>What happens after <code>addDataToMap</code>:</p><ul><li>Kepler adds the dataset to state.</li><li>If <code>options.autoCreateLayers !== false</code>, Kepler auto-creates a layer based on columns.</li></ul><h2 id=4-pitfalls--workarounds>4) Pitfalls / workarounds</h2><h3 id=41-arrow-version-mismatch>4.1 Arrow version mismatch</h3><p>If your app bundle ends up with multiple <code>apache-arrow</code> versions, Arrow vector instances may become incompatible at runtime.</p><p>Workaround: pin <code>apache-arrow</code> to one version at the application <code>package.json</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;overrides&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;apache-arrow&#34;</span><span class=p>:</span> <span class=s2>&#34;17.0.0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=42-temp-table-collisions>4.2 Temp table collisions</h3><p>If you allow concurrent runs, fixed temp table names (like <code>temp_keplergl_table</code>) can collide.</p><p>Workaround: include a run-scoped suffix in the temp table name.</p><h3 id=43-avoid-arrow--js-row-materialization-for-large-results>4.3 Avoid Arrow ‚Üí JS row materialization for large results</h3><p>Avoid converting Arrow results to JS row arrays for large datasets. Prefer the Arrow-native payload (<code>format: 'arrow'</code>) shown above.</p></article></div></div></div></div><footer class="footer text-muted"><div class=container><div class=col-16><ul class=list-inline><li class=list-inline-item><a href=/legal/>Legal</a></li><li class=list-inline-item><a href=/docs/about/overture-maps-examples/>Overture Maps Examples</a></li><li class=list-inline-item><a href=/docs/about/kepler-gl-map-examples/>Kepler.gl Maps Examples</a></li><li class=list-inline-item><a href=/carto/>CARTO Alternative</a></li><li class=list-inline-item><a href=/blog/>Blog</a></li></ul></div></div></footer><script src=https://dekart.xyz/main.6aedabf29b1e9276b2cecddc8ad7aa10bc927a3bee04aa5d5671088a8af6a2a939fd5e8c8a1de6ffc40607e5478a5e47644959bd7fad3807ef443d60ee5d8263.js integrity="sha512-au2r8pseknayzs3citeqELySejvuBKpdVnEIior2oqk5/V6Mih3m/8QGB+VHil5HZElZvX+tOAfvRD1g7l2CYw==" crossorigin=anonymous defer></script>
<script src=https://dekart.xyz/index.min.f972446c2fa3805b98b8f39881162670e6fcb7acfc9241e21e2f4506fbaac973b9da508dc01df0ddef18b5c68290d6d66ad3156983888489159e8ede971d39ff.js integrity="sha512-+XJEbC+jgFuYuPOYgRYmcOb8t6z8kkHiHi9FBvuqyXO52lCNwB3w3e8YtcaCkNbWatMVaYOIhIkVno7elx05/w==" crossorigin=anonymous defer></script></body></html>