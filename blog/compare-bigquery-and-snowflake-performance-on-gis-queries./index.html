<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://dekart.xyz/main.12864657bacf92cd919a8e257f15589229a6200afff0af7b87fa336ee55c6c0d0094f5397bd86b16c4967e7ac2c8ecdacddee138c2fdf44a6e470173122e6760.css integrity="sha512-EoZGV7rPks2Rmo4lfxVYkimmIAr/8K97h/ozbuVcbA0AlPU5e9hrFsSWfnrCyOzazd7hOML99EpuRwFzEi5nYA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Compare BigQuery and Snowflake performance on GIS queries. - Dekart</title><meta name=description content="Compare BigQuery and Snowflake on GIS query performance. Explore execution times, costs, and efficiency in a Geometry-in-Polygon use case with real-world data from Overture Maps"><link rel=canonical href=https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map.png"><meta name=twitter:title content="Compare BigQuery and Snowflake performance on GIS queries."><meta name=twitter:description content="Compare BigQuery and Snowflake on GIS query performance. Explore execution times, costs, and efficiency in a Geometry-in-Polygon use case with real-world data from Overture Maps"><meta name=twitter:creator content="@delfrrr"><meta property="og:title" content="Compare BigQuery and Snowflake performance on GIS queries."><meta property="og:description" content="Compare BigQuery and Snowflake on GIS query performance. Explore execution times, costs, and efficiency in a Geometry-in-Polygon use case with real-world data from Overture Maps"><meta property="og:type" content="article"><meta property="og:url" content="https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./"><meta property="og:image" content="https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map.png"><meta property="article:published_time" content="2024-12-03T05:59:51+00:00"><meta property="article:modified_time" content="2024-12-03T22:49:31+01:00"><meta property="og:site_name" content="Dekart"><meta property="og:locale" content="en_US"><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://dekart.xyz/apple-icon.png><link rel=icon type=image/png sizes=32x32 href=https://dekart.xyz/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://dekart.xyz/favicon-16x16.png><link rel=manifest href=https://dekart.xyz/site.webmanifest><script defer data-domain=dekart.xyz src=https://plausible.io/js/script.tagged-events.js></script></head><body><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label>
<a class="navbar-brand order-1 order-md-0 mr-auto" href=https://dekart.xyz/>Dekart</a><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=http://github.com/dekart-xyz/dekart><svg width="24" height="24" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M512 0C229.12.0.0 229.12.0 512c0 226.56 146.56 417.92 350.08 485.76 25.6 4.48 35.2-10.88 35.2-24.32.0-12.16-.64-52.48-.64-95.36-128.64 23.68-161.92-31.36-172.16-60.16-5.76-14.72-30.72-60.16-52.48-72.32-17.92-9.6-43.52-33.28-.64-33.92 40.32-.64 69.12 37.12 78.72 52.48 46.08 77.44 119.68 55.68 149.12 42.24 4.48-33.28 17.92-55.68 32.64-68.48-113.92-12.8-232.96-56.96-232.96-252.8.0-55.68 19.84-101.76 52.48-137.6-5.12-12.8-23.04-65.28 5.12-135.68.0.0 42.88-13.44 140.8 52.48 40.96-11.52 84.48-17.28 128-17.28s87.04 5.76 128 17.28c97.92-66.56 140.8-52.48 140.8-52.48 28.16 70.4 10.24 122.88 5.12 135.68 32.64 35.84 52.48 81.28 52.48 137.6.0 196.48-119.68 240-233.6 252.8 18.56 16 34.56 46.72 34.56 94.72.0 68.48-.64 123.52-.64 140.8.0 13.44 9.6 29.44 35.2 24.32C877.44 929.92 1024 737.92 1024 512 1024 229.12 794.88.0 512 0z" fill="#1b1f23"/></svg><span class="ml-2 sr-only">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href="https://cloud.dekart.xyz/?ref=login">Login</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://dekart.xyz/cloud>Pricing</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://dekart.xyz/docs/>Docs</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://github.com/dekart-xyz/dekart>GitHub</a></li><li class=nav-item><div id=suggestions class="shadow bg-white rounded"></div><a class="nav-link text-nowrap" href=https://slack.dekart.xyz>Slack</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>Compare BigQuery and Snowflake performance on GIS queries.</h1><p><small>by <a class="stretched-link position-relative" href=https://dekart.xyz/contributors/vladi/>Vladi</a>&nbsp;&dash;&nbsp;<strong>2&nbsp;min read</strong></small><p></div><p class=lead>Geometry-in-Polygon Query.</p><p>This is the first in a series of posts comparing BigQuery and Snowflake on GIS query performance. We’ll examine execution times, data scanned, and cost. This test focuses on a <strong>Geometry-in-Polygon query</strong> using constant geometry—a simple GIS use case.</p><h2 id=setup>Setup</h2><ul><li>BigQuery (price $5/Tb data processes)</li><li>Snowflake (XS warehouse, $2.60/credit)</li><li>Free Overture Maps Dataset available on both platforms from same provider</li><li>Dekart to validate visually results</li></ul><h2 id=get-all-the-roads-in-berlin--constant-geometry>Get all the roads in Berlin – constant geometry</h2><p>I started from one most common scenario – geometry in polygons. Practical example: Get all the roads in Berlin. SQL function used ST_CONTAINS. Performance of this query would depend on scaling, clustering and partitioning of both databases.</p><p>Let’s start from simple case when geometry is constant in query.</p><figure><img class="img-fluid lazyload" data-sizes=auto src=https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_20x0_resize_box_3.png data-srcset="https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_2048x0_resize_box_3.png 2048w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_1600x0_resize_box_3.png 1600w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_1024x0_resize_box_3.png 1024w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_512x0_resize_box_3.png 512w" width=2792 height=2010><noscript><img class=img-fluid sizes=100vw srcset="https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_2048x0_resize_box_3.png 2048w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_1600x0_resize_box_3.png 1600w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_1024x0_resize_box_3.png 1024w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map_hu63b731820d95b0b88a1422adbf85dc91_1487765_512x0_resize_box_3.png 512w" src=https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./dekart-map.png width=2792 height=2010></noscript></figure><p class=view-on-map><a href="https://cloud.dekart.xyz/reports/e7884281-a440-458f-8d2a-5e6e60322c47?ref=dekart-xyz-view-map" target=_blank class="btn btn-outline-primary btn-sm">View interactive map</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- BigQuery
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>geometry</span><span class=p>,</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>subtype</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=n>bigquery</span><span class=o>-</span><span class=k>public</span><span class=o>-</span><span class=k>data</span><span class=p>.</span><span class=n>overture_maps</span><span class=p>.</span><span class=n>segment</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>subtype</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;road&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;secondary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;tertiary&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>ST_CONTAINS</span><span class=p>(</span><span class=n>ST_GEOGFROMTEXT</span><span class=p>(</span><span class=s1>&#39;MULTIPOLYGON(((...)))&#39;</span><span class=p>),</span><span class=w> </span><span class=n>geometry</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- Snowflake
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>geometry</span><span class=p>,</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>subtype</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>OVERTURE_MAPS__TRANSPORTATION</span><span class=p>.</span><span class=n>CARTO</span><span class=p>.</span><span class=n>SEGMENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>subtype</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;road&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;secondary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;tertiary&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>ST_CONTAINS</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ST_GEOGRAPHYFROMWKT</span><span class=p>(</span><span class=s1>&#39;MULTIPOLYGON(((...)))&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>geometry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p class=playground-link><a href='https://cloud.dekart.xyz/reports/e7884281-a440-458f-8d2a-5e6e60322c47/source?ref=dekart-xyz-open-editor' target=_blank class="btn btn-outline-primary btn-sm">Open query in editor</a></p><h3 id=result>Result</h3><table class=table><thead><tr><th>Database</th><th>Duration</th><th>Bytes Scanned</th><th>Cost</th></tr></thead><tbody><tr><td>BigQuery</td><td>1s</td><td>516.05 MB</td><td>$0.002515</td></tr><tr><td>Snowflake</td><td>1m 17s</td><td>63.61GB</td><td>$0.0556</td></tr></tbody></table><h3 id=query-plans>Query plans</h3><figure><img class="img-fluid lazyload" data-sizes=auto src=https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_20x0_resize_box_3.png data-srcset="https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_2048x0_resize_box_3.png 2048w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_1600x0_resize_box_3.png 1600w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_1024x0_resize_box_3.png 1024w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_512x0_resize_box_3.png 512w" width=1876 height=1066><noscript><img class=img-fluid sizes=100vw srcset="https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_2048x0_resize_box_3.png 2048w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_1600x0_resize_box_3.png 1600w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_1024x0_resize_box_3.png 1024w,https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans_hud00a031d59baa330694eda78a6a0b840_167226_512x0_resize_box_3.png 512w" src=https://dekart.xyz/blog/compare-bigquery-and-snowflake-performance-on-gis-queries./query-plans.png width=1876 height=1066></noscript></figure><h2 id=key-insights>Key insights</h2><ul><li>BigQuery reads only a small portion of the table, leveraging clustering and geospatial partitioning effectively.</li><li>Snowflake reads ~80% of the table, with 89% of query time spent on Remote Disk I/O.</li></ul><p>In this test, BigQuery is much faster and cheaper than Snowflake.</p><h2 id=feature-gap>Feature Gap</h2><h3 id=snowflake-search-optimization>Snowflake Search Optimization</h3><p>In theory, the Snowflake search optimization service should improve the performance of queries with predicates that use geospatial functions with GEOGRAPHY objects. This feature requires Enterprise Edition according to the documentation. It has also required to be applied to the column.</p><p>I, tried to verify if feature is configured on dataset:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DESCRIBE</span><span class=w> </span><span class=k>SEARCH</span><span class=w> </span><span class=n>OPTIMIZATION</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>OVERTURE_MAPS__TRANSPORTATION</span><span class=p>.</span><span class=n>CARTO</span><span class=p>.</span><span class=n>SEGMENT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- empty result
</span></span></span></code></pre></div><p>However, when I leave only ST_CONTAINS in the filter, Snowflake scans only 60% of the table, and I keep seeing Search Optimization Access node in the query planner. So it appears that Search Optimization is applied to my query.</p><h3 id=bigger-warehouse-size>Bigger warehouse size</h3><p>Will execution time become better with a bigger warehouse size on Snowflake? With 89% of the query time being Remote Disk I/O, it probably will not improve more than 10%.</p><h2 id=what-is-next>What is next?</h2><p>While this difference between BigQuery and Snowflake seems astonishing, in the next post we will look at more realistic examples where geometry is not constant and comparison between databases is closer.</p><p>This article will be updated with feedback and links to other tests.</p></article></div></div></div></div><footer class="footer text-muted"><div class=container><div class=col-16><ul class=list-inline><li class=list-inline-item>🛟 <a href=https://slack.dekart.xyz/ target=_blank>Ask in Slack</a></li><li class=list-inline-item><a href=/legal/>Legal</a></li><li class=list-inline-item><a href=/carto/>Lightweight alternative to CARTO</a></li></ul></div></div></footer><script src=https://dekart.xyz/main.88a2aeb48a6ab750d96c50e8e4ec39d7775cc1989c5a61b8c11597220cd62f3fc1a4cd9cf81a728359f68e543002862714c0f73a6a91b1bd829b5c58dab74893.js integrity="sha512-iKKutIpqt1DZbFDo5Ow513dcwZicWmG4wRWXIgzWLz/BpM2c+Bpyg1n2jlQwAoYnFMD3OmqRsb2Cm1xY2rdIkw==" crossorigin=anonymous defer></script>
<script src=https://dekart.xyz/index.min.cbb07ebcc68ebe47272721d196c860856c6f5bc4d203b7f5b5425a766a36b07ac51159949e1eef52d404286581628c7411fadf246102bbb628158b992ea55f03.js integrity="sha512-y7B+vMaOvkcnJyHRlshghWxvW8TSA7f1tUJadmo2sHrFEVmUnh7vUtQEKGWBYox0EfrfJGECu7YoFYuZLqVfAw==" crossorigin=anonymous defer></script></body></html>